#!/bin/bash
set -e

echo "ğŸ“‚ Stelle sicher, dass das Installationsverzeichnis existiert..."
mkdir -p /usr/lib/container-manager/
mkdir -p /usr/local/bin/

echo "ğŸ“‚ Erstelle virtuelle Umgebung fÃ¼r Container-Manager..."
python3 -m venv /usr/lib/container-manager/env
source /usr/lib/container-manager/env/bin/activate

# Erstelle oder Ã¼berschreibe die requirements.txt, falls sie nicht existiert
if [ ! -f "/usr/lib/container-manager/requirements.txt" ]; then
    echo "ğŸ“‚ Erstelle requirements.txt..."
    cat <<EOT > /usr/lib/container-manager/requirements.txt
click
rich
pyyaml
requests
packaging
InquirerPy
docker
EOT
fi

echo "ğŸ“‚ PrÃ¼fe, ob requirements.txt existiert..."
if [ ! -f "/usr/lib/container-manager/requirements.txt" ]; then
    echo "ğŸš¨ ERROR: /usr/lib/container-manager/requirements.txt nicht gefunden!"
    ls -lah /usr/lib/container-manager/  # Debugging
    exit 1
fi

echo "ğŸ“‚ Installiere AbhÃ¤ngigkeiten..."
pip install --upgrade pip
pip install -r /usr/lib/container-manager/requirements.txt

# ğŸš€ WICHTIG: Stelle sicher, dass `netzint-cli` richtig installiert wird!
echo "ğŸ“‚ ÃœberprÃ¼fe, ob netzint-cli in /usr/local/bin/ vorhanden ist..."
if [ ! -f "/usr/local/bin/netzint-cli" ]; then
    echo "ğŸš¨ Datei nicht gefunden! Manuelles Kopieren..."
    cp -f /usr/lib/container-manager/netzint-cli /usr/local/bin/netzint-cli
fi

echo "ğŸ“‚ Setze Berechtigungen fÃ¼r netzint-cli..."
chmod +x /usr/local/bin/netzint-cli

echo "ğŸ“‚ PrÃ¼fe, ob die Datei jetzt existiert..."
ls -lah /usr/local/bin/netzint-cli || echo "ğŸš¨ Datei wurde nicht kopiert!"

echo "ğŸ“‚ Installation abgeschlossen!"
